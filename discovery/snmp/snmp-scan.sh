mkdir -p result-$1

nmap --open -Pn -v -sU -p 161 -oG ${1}.gnmap $1

for i in $(grep '161/open' ${1}.gnmap |awk '{ print $2 }')
do
    for j in $(cat communities.db)
    do
       (snmpwalk -v2c -c $j $i &> result-${1}/${i}-${j}.txt) &
    done
done

#sleep 15
sleep 30

for empty in $(grep -L "iso" result-$1/*.txt |cut -d":" -f 1)
do
	rm $empty
done
